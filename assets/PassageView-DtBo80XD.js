import{d as L,r as d,b as P,m as C,e as p,c as o,f as n,g as h,F as E,i as x,k as A,t as u,u as B,o as a,_ as D}from"./index-UYb-AM8x.js";const H={class:"passage-view"},I={class:"passage-list"},R=["onClick"],S={key:0},T=["href"],U={key:1},V={class:"first-segment"},b={class:"created-at"},M={key:0,class:"loading-more"},F={key:1,class:"no-more"},v=10,N=L({__name:"PassageView",setup(z){const l=d([]),f=d(1),m=d(!0),i=d(!1),w=B();P(async()=>{await g(),window.addEventListener("scroll",_)}),C(()=>{window.removeEventListener("scroll",_)});const g=async()=>{if(!(!m.value||i.value)){i.value=!0;try{const s=(f.value-1)*v,t=await p.passages.orderBy("createdAt").reverse().offset(s).limit(v).toArray(),e=[];for(const c of t)if(c.id!==void 0){const r=await p.passageContents.where({passageId:c.id,segmentIndex:0}).first();e.push({...c,content:"",translation:"",firstSegmentContent:(r==null?void 0:r.content)||"",firstSegmentTranslation:(r==null?void 0:r.translation)||""})}console.log("Loaded passages for list view:",e),t.length<v&&(m.value=!1),f.value===1?l.value=e:l.value=[...l.value,...e],f.value++}catch(s){console.error("加载文章失败:",s)}finally{i.value=!1}}},_=()=>{const s=document.documentElement.scrollHeight,t=document.documentElement.scrollTop,e=document.documentElement.clientHeight;t+e>=s-100&&g()},y=s=>{w.push({name:"passage-content",params:{id:s}})},k=s=>{if(!s)return!1;try{return new URL(s),!0}catch(t){return console.error("Invalid URL:",t),!1}};return(s,t)=>(a(),o("div",H,[t[3]||(t[3]=n("h1",null,"日语文章段落学习",-1)),n("div",I,[(a(!0),o(E,null,x(l.value,e=>(a(),o("div",{key:e.id,class:"passage-item",onClick:c=>e.id&&y(e.id)},[k(e.source)?(a(),o("h3",S,[n("a",{href:e.source,target:"_blank",rel:"noopener noreferrer",onClick:t[0]||(t[0]=A(()=>{},["stop"]))},u(e.name),9,T)])):(a(),o("h3",U,u(e.name),1)),n("p",V,"原文: "+u(e.firstSegmentContent),1),n("p",b,u(e.createdAt?new Date(e.createdAt).toLocaleDateString():""),1)],8,R))),128)),i.value?(a(),o("div",M,t[1]||(t[1]=[n("span",null,"加载更多文章...",-1)]))):h("",!0),!m.value&&l.value.length>0?(a(),o("div",F,t[2]||(t[2]=[n("span",null,"没有更多文章了",-1)]))):h("",!0)])]))}}),j=D(N,[["__scopeId","data-v-3e40984d"]]);export{j as default};
