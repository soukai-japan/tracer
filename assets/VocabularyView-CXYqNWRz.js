import{d as Y,r as c,b as Z,e as d,j as ee,c as n,f as t,g as f,n as O,F as I,i as T,k as x,t as r,l as m,h as b,v as k,o,_ as te}from"./index-UYb-AM8x.js";const ae={class:"vocabulary-view"},le={class:"tag-filter-container"},se=["onClick"],ie=["onClick"],ne={class:"vocabulary-list"},oe=["onClick"],re={class:"created-at"},ue={class:"word-tags"},de={key:0,class:"tag-pill untagged"},ve={class:"modal-content"},ge={key:0},pe={key:1},ce={key:2},fe={key:3},me={class:"modal-content"},ye={class:"form-group"},we={class:"form-group"},be={class:"form-group"},ke={class:"form-group"},Ie={class:"form-group"},he={class:"form-group"},Te={class:"form-group"},xe={class:"form-group tags-section"},Ae={class:"tag-container"},Ce=["onClick"],Se=["onClick"],De={class:"add-tag-container"},Ve=Y({__name:"VocabularyView",setup(Oe){const A=c([]),W=c([]),v=c(void 0);Z(async()=>{await C(),await S()});const C=async()=>{const i=await d.words.orderBy("createdAt").reverse().toArray();A.value=await Promise.all(i.map(async e=>{if(e.tagIds&&e.tagIds.length>0){const u=await d.tags.where("id").anyOf(e.tagIds).toArray();return{...e,tags:u}}return e}))},S=async()=>{W.value=await d.tags.where("type").equals("vocabulary").toArray()},G=ee(()=>v.value?A.value.filter(i=>v.value===-1?!i.tagIds||i.tagIds.length===0:v.value!==void 0?i.tagIds&&i.tagIds.includes(v.value):!0):A.value),_=c(!1),s=c(null),y=c([]),D=c(!1),a=c(null),h=c([]),w=c(""),q=async i=>{const e=await d.words.where("tagIds").equals(i).toArray();if(e.length>0){if(!confirm("标签存在关联的单词，删除标签则清空所有关联单词的标签。确定删除吗？"))return;for(const g of e)g.tagIds&&(g.tagIds=g.tagIds.filter(V=>V!==i),await d.words.put(g))}await d.tags.delete(i),h.value=h.value.filter(u=>u.id!==i),await S(),await C()},H=async i=>{const e=A.value.find(u=>u.id===i)||null;s.value=e,e&&e.tagIds&&e.tagIds.length>0?y.value=await d.tags.where("id").anyOf(e.tagIds).toArray():y.value=[],_.value=!0},N=()=>{_.value=!1,s.value=null,y.value=[]},J=async()=>{s.value&&(a.value={...s.value},await $(),D.value=!0)},K=async()=>{if(a.value&&a.value.id!==void 0){const i={id:a.value.id!==void 0?Number(a.value.id):void 0,writing:String(a.value.writing),reading:a.value.reading?String(a.value.reading):"",chineseTranslation:a.value.chineseTranslation?String(a.value.chineseTranslation):"",pitch:a.value.pitch?String(a.value.pitch):"",partOfSpeech:a.value.partOfSpeech?String(a.value.partOfSpeech):"",example:a.value.example?String(a.value.example):"",createdAt:a.value.createdAt?new Date(a.value.createdAt):new Date,tagIds:Array.isArray(a.value.tagIds)?a.value.tagIds.map(e=>Number(e)):[]};try{if(await d.words.put(i),D.value=!1,a.value=null,await C(),await S(),s.value&&s.value.id){const e=await d.words.get(s.value.id);e&&(s.value=e,e.tagIds&&e.tagIds.length>0?y.value=await d.tags.where("id").anyOf(e.tagIds).toArray():y.value=[])}}catch(e){console.error("Error saving word:",e)}}},U=()=>{D.value=!1,a.value=null},Q=async()=>{s.value&&s.value.id!==void 0&&(await d.words.delete(s.value.id),await C(),N(),console.log("删除单词",s.value))},$=async()=>{h.value=await d.tags.where("type").equals("vocabulary").toArray()},R=i=>{var e,u;if(a.value){const g=((e=a.value.tagIds)==null?void 0:e.indexOf(i))??-1;g>-1?(u=a.value.tagIds)==null||u.splice(g,1):(a.value.tagIds||(a.value.tagIds=[]),a.value.tagIds.push(i))}},X=async()=>{if(w.value.trim()===""){alert("标签名称不能为空！");return}try{if(await d.tags.where("name").equalsIgnoreCase(w.value.trim()).first()){alert("标签已存在！");return}const e=await d.tags.add({name:w.value.trim(),type:"vocabulary",createdAt:new Date}),u={id:e,name:w.value.trim(),type:"vocabulary",createdAt:new Date};h.value.push(u),a.value&&(a.value.tagIds=a.value.tagIds||[],a.value.tagIds.push(e)),w.value="",await $(),await S()}catch(i){console.error("添加标签失败:",i),alert("添加标签失败！")}};return(i,e)=>{var u,g,V,M,E,L,B,F,j,z,P;return o(),n(I,null,[t("div",ae,[e[9]||(e[9]=t("h1",null,"日语单词学习",-1)),t("div",le,[t("span",{class:O(["tag-filter-item",{active:v.value===void 0}]),onClick:e[0]||(e[0]=l=>v.value=void 0)},"全部",2),t("span",{class:O(["tag-filter-item",{active:v.value===-1}]),onClick:e[1]||(e[1]=l=>v.value=-1)},"未分类",2),(o(!0),n(I,null,T(W.value,l=>(o(),n("span",{key:l.id,class:O(["tag-filter-item",{active:v.value===l.id}]),onClick:p=>l.id!==void 0&&(v.value=l.id)},[m(r(l.name)+" ",1),l.id!==void 0?(o(),n("span",{key:0,class:"delete-tag-button filter-tag-delete-button",onClick:x(p=>q(l.id),["stop"])},"x",8,ie)):f("",!0)],10,se))),128))]),t("div",ne,[(o(!0),n(I,null,T(G.value,l=>(o(),n("div",{key:l.id,class:"vocabulary-item",onClick:p=>l.id!==void 0&&H(l.id)},[t("h3",null,r(l.writing),1),t("p",null,r(l.chineseTranslation),1),t("p",re,r(l.createdAt?new Date(l.createdAt).toLocaleDateString():"N/A"),1),t("div",ue,[(o(!0),n(I,null,T(l.tags,p=>(o(),n("span",{key:p.id,class:"tag-pill"},r(p.name),1))),128)),!l.tags||l.tags.length===0?(o(),n("span",de,"未分类")):f("",!0)])],8,oe))),128))])]),_.value?(o(),n("div",{key:0,class:"modal-overlay",onClick:x(N,["self"])},[t("div",ve,[t("h2",null,r((u=s.value)==null?void 0:u.writing),1),t("p",null,[e[10]||(e[10]=t("strong",null,"ID:",-1)),m(" "+r(((g=s.value)==null?void 0:g.id)!==void 0?s.value.id:"N/A"),1)]),t("p",null,[e[11]||(e[11]=t("strong",null,"读法:",-1)),m(" "+r((V=s.value)==null?void 0:V.reading),1)]),t("p",null,[e[12]||(e[12]=t("strong",null,"汉语翻译:",-1)),m(" "+r((M=s.value)==null?void 0:M.chineseTranslation),1)]),t("p",null,[e[13]||(e[13]=t("strong",null,"创建日期:",-1)),m(" "+r((E=s.value)!=null&&E.createdAt?new Date(s.value.createdAt).toLocaleDateString():"N/A"),1)]),(L=s.value)!=null&&L.pitch?(o(),n("p",ge,[e[14]||(e[14]=t("strong",null,"声调:",-1)),m(" "+r((B=s.value)==null?void 0:B.pitch),1)])):f("",!0),(F=s.value)!=null&&F.partOfSpeech?(o(),n("p",pe,[e[15]||(e[15]=t("strong",null,"词性:",-1)),m(" "+r((j=s.value)==null?void 0:j.partOfSpeech),1)])):f("",!0),(z=s.value)!=null&&z.example?(o(),n("p",ce,[e[16]||(e[16]=t("strong",null,"例句:",-1)),m(" "+r((P=s.value)==null?void 0:P.example),1)])):f("",!0),y.value.length>0?(o(),n("p",fe,[e[17]||(e[17]=t("strong",null,"标签:",-1)),(o(!0),n(I,null,T(y.value,(l,p)=>(o(),n("span",{key:l.id??p},r(l.name)+r(p<y.value.length-1?", ":""),1))),128))])):f("",!0),t("div",{class:"modal-actions"},[t("button",{onClick:J},"编辑"),t("button",{onClick:Q},"删除"),t("button",{onClick:N},"关闭")])])])):f("",!0),D.value?(o(),n("div",{key:1,class:"modal-overlay",onClick:x(U,["self"])},[t("div",me,[e[27]||(e[27]=t("h2",null,"编辑单词",-1)),t("form",{onSubmit:x(K,["prevent"])},[t("div",ye,[e[18]||(e[18]=t("label",{for:"edit-writing"},"书写法:",-1)),b(t("input",{type:"text",id:"edit-writing","onUpdate:modelValue":e[2]||(e[2]=l=>a.value.writing=l),required:""},null,512),[[k,a.value.writing]])]),t("div",we,[e[19]||(e[19]=t("label",{for:"edit-reading"},"读法:",-1)),b(t("input",{type:"text",id:"edit-reading","onUpdate:modelValue":e[3]||(e[3]=l=>a.value.reading=l),required:""},null,512),[[k,a.value.reading]])]),t("div",be,[e[20]||(e[20]=t("label",{for:"edit-chineseTranslation"},"汉语翻译:",-1)),b(t("input",{type:"text",id:"edit-chineseTranslation","onUpdate:modelValue":e[4]||(e[4]=l=>a.value.chineseTranslation=l),required:""},null,512),[[k,a.value.chineseTranslation]])]),t("div",ke,[e[21]||(e[21]=t("label",{for:"edit-pitch"},"声调 (可选):",-1)),b(t("input",{type:"text",id:"edit-pitch","onUpdate:modelValue":e[5]||(e[5]=l=>a.value.pitch=l)},null,512),[[k,a.value.pitch]])]),t("div",Ie,[e[22]||(e[22]=t("label",{for:"edit-partOfSpeech"},"词性 (可选):",-1)),b(t("input",{type:"text",id:"edit-partOfSpeech","onUpdate:modelValue":e[6]||(e[6]=l=>a.value.partOfSpeech=l)},null,512),[[k,a.value.partOfSpeech]])]),t("div",he,[e[23]||(e[23]=t("label",{for:"edit-example"},"例句 (可选):",-1)),b(t("textarea",{id:"edit-example","onUpdate:modelValue":e[7]||(e[7]=l=>a.value.example=l)},null,512),[[k,a.value.example]])]),t("div",Te,[e[25]||(e[25]=t("label",{for:"edit-tags"},"标签 (可选):",-1)),t("div",xe,[e[24]||(e[24]=t("label",null,"标签:",-1)),t("div",Ae,[(o(!0),n(I,null,T(h.value,l=>(o(),n("div",{key:l.id,class:O(["tag-item",{"tag-selected":a.value.tagIds&&l.id!==void 0&&a.value.tagIds.includes(l.id)}]),onClick:p=>l.id!==void 0&&R(l.id)},[m(r(l.name)+" ",1),l.id!==void 0?(o(),n("span",{key:0,class:"delete-tag-button",onClick:x(p=>q(l.id),["stop"])},"x",8,Se)):f("",!0)],10,Ce))),128))]),t("div",De,[b(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=l=>w.value=l),placeholder:"新标签名称",class:"tag-input"},null,512),[[k,w.value]]),t("button",{type:"button",onClick:X,class:"add-tag-button"},"+")])])]),t("div",{class:"modal-actions"},[e[26]||(e[26]=t("button",{type:"submit"},"保存",-1)),t("button",{type:"button",onClick:U},"取消")])],32)])])):f("",!0)],64)}}}),Ne=te(Ve,[["__scopeId","data-v-b88bb4a9"]]);export{Ne as default};
